---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

**Brief Introduction**

*The nursing home data are provided by the Wisconsin Department of Health and Family Services (DHFS). The State of Wisconsin Medicaid program funds nursing home care for individuals qualifying on the basis of need and financial status. As part of the conditions for participation, Medicaid-certified nursing homes must file an annual cost report to DHFS, summarizing the volume and cost of care provided to all of its residents, Medicaid funded and otherwise. These cost reports are audited by DHFS staff and form the basis for facility-specific Medicaid daily payment rates for subsequent periods. Note: A nursing home is a facility for the residential care of elderly or disabled people.*

**Objective**

*The aim of this project is to develop a predictive model that provide reliable utilization forecast to update their Medicaid funding rate schedule of nursing facilities.*

**Data**

*The data here is in cost report years 2000 and 2001. There are 362 facilities in 2000 and 355 facilities in 2001. Typically, utilization of nursing home care is measured in patient days (“patient days” is the number of days each patient was in the facility, summed over all patients).*

**Variables**

| File Name:WiscNursingHome         | Number of obs: 717        | Number of variables: 12                       |
|:---------------------------------:|:-------------------------:|:---------------------------------------------:|
| **Variable (type of variable)**   | **Number of Obs Missing** | **Description**                               |
| hospID (categorical)              |                           | Hospital identification number                |
| CRYEAR (categorical binary)       |                           | Cost report year                              |
| TPY (quantitative continuous)     |                           | Total patient years                           |
| NUMBED (quantitative discrete)    |                           | Number of beds                                |
| SQRFOOT (quantitative continuous) |    10                     | Square footage of the nursing home            |
| MSA (categorical)                 |                           | Metropol Statist Area code, 1-13, 0 for rural |
| URBAN (categorical Binary)        |                           | 1 if urban, 0 if rural                        |
| PRO (categorical Binary)          |                           | 1 if for profit, 0 for non-profit             |
| TAXEXEMPT (categorical Binary)    |                           | 1 if tax-exempt                               |
| SELFFUNDINS (categorical Binary)  |                           | 1 if self-funded for insurance                |
| MCERT (categorical Binary)        |                           | 1 if Medicare certified                       |
| ORGSTR (categorical)              |                           | 1 for profit, 2 for tax-exempt,3 for gov unit |



```{r}
datafile <- read.csv("WiscNursingHome.csv")
datafile
```

**Analyzing variables distribution**
```{r}
# Set the layout of the graph
par(mfrow = c(3,4))

# Draw the first histogram
hist(datafile$TPY, main = "Histogram of TPY", xlab = "TPY", col = "blue")

# Draw the second histogram
hist(datafile$NUMBED, main = "Histogram of NUMBED", xlab = "NUMBED", col = "blue")

# Draw the third histogram
hist(datafile$SQRFOOT, main = "Histogram of SQRFOOT", xlab = "SQRFOOT", col = "blue")
hist(datafile$MSA, main = "Histogram of MSA", xlab = "MSA", col = "purple")
hist(datafile$URBAN, main = "Histogram of URBAN", xlab = "URBAN", col = "green")
hist(datafile$PRO, main = "Histogram of PRO", xlab = "PRO", col = "green")
hist(datafile$TAXEXEMPT, main = "Histogram of TAXEXEMPT", xlab = "TAXEXEMPT", col = "green")
hist(datafile$SELFFUNDINS, main = "Histogram of SELFFUNDINS", xlab = "SELFFUNDINS", col = "green")
hist(datafile$MCERT, main = "Histogram of MCERT", xlab = "MCERT", col = "green")
hist(datafile$ORGSTR, main = "Histogram of ORGSTR", xlab = "ORGSTR", col = "purple")
```

### *Analysis of quantitative variables*

*We create a data frame only with the quantitative variables to draw the pair plot*



```{r}
datafile <- na.omit(datafile) # remove missing values
new_df <- subset(datafile, select = -c(hospID, CRYEAR, MSA, URBAN, PRO, TAXEXEMPT, SELFFUNDINS, MCERT, ORGSTR))
```


```{r}
library(ggplot2)
library(GGally)
ggpairs(new_df)
```

*From the histograms and pair plots for the the non binary variables, we can see that the quantitative variables are skewed to the right. Then a log normal transformation of the variables should be useful for the statistical analysis*  
*The variable MSA have a bi modal distribution with modes in approximately 0 and 12.*
*With respect to the correlation, the quantitative variables TPY and NUMBED are highly correlated (0.984). This high correlation means that both variables have the same information, which should be redundant to include in a single model. On the other hand, the correlation of SQRFOOT with TPY and NUMBED is respectively 0.822 and 0.814.*

*Let's see the summary statistics for the quantitative variables*

```{r}
summary(new_df)
```

```{r}

par(mfrow = c(1, 3))

boxplot(new_df$TPY, main = "Boxplot TPY")
 
boxplot(new_df$NUMBED, main = "Boxplot NUMBED")

boxplot(new_df$SQRFOOT, main = "Boxplot SQRFOOT")
```

*We can see clearly that the distributions are right skewed, many outliers (observations outside of the whisker) the means of the TPY and NUMBED variables are close, while the mean for SRQFOOT is less than the half the others.*


**Let's transform the skewed quantitative variables with the log function**

```{r}
library(dplyr)
new_df_log <- new_df %>% mutate(TPY_log = log(TPY), NUMBED_log = log(NUMBED), SQRFOOT_log = log(SQRFOOT))
new_df_log
```


```{r}
# Set the layout of the graph
par(mfrow = c(2,3))

# Draw the first histogram
hist(new_df_log$TPY, main = "Histogram of TPY", xlab = "TPY", col = "blue")

# Draw the second histogram
hist(new_df_log$NUMBED, main = "Histogram of NUMBED", xlab = "NUMBED", col = "blue")

# Draw the third histogram
hist(new_df_log$SQRFOOT, main = "Histogram of SQRFOOT", xlab = "SQRFOOT", col = "blue")
hist(new_df_log$TPY_log, main = "Histogram of TPY_log", xlab = "TPY_log", col = "orange")
hist(new_df_log$NUMBED_log, main = "Histogram of NUMBED_log", xlab = "NUMBED_log", col = "orange")
hist(new_df_log$SQRFOOT_log, main = "Histogram of SQRFOOT_log", xlab = "SQRFOOT_log", col = "orange")

```

*Let's create a data frame only with the transformed variables and the results for the pairplot* 

```{r}
new_df_log <- subset(new_df_log, select = -c(TPY, NUMBED, SQRFOOT))
new_df_log
```
*Let's see the summary statistics for the log transformed variables*

```{r}
summary(new_df_log)
```

*It is clear that now the variables have a log normal distribution since the mean and the median are much closer as well as the first and fourth quantile, let's see this graphically with a box plot*



```{r}

par(mfrow = c(1, 3))

boxplot(new_df_log$TPY_log, main = "Boxplot TPY_log")
 
boxplot(new_df_log$NUMBED_log, main = "Boxplot NUMBED_log")

boxplot(new_df_log$SQRFOOT_log, main = "Boxplot SQRFOOT_log")
```
